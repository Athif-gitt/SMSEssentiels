{% extends 'base.html' %}
{% block content %}
<div class="row mb-3">
    <div class="col-md-6">
        <h2>Students</h2>
    </div>
    <div class="col-md-6 text-end">
        <a href="{% url 'students:student_create' %}" class="btn btn-primary">Add New Student</a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-10">
                <input type="text" name="q" class="form-control placeholder-light" placeholder="Search by name or roll number"
                    value="{{ query }}">
                    <style>
                        .placeholder-light::placeholder {
    color: gray;}
                    </style>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-secondary w-100">Search</button>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Profile</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Course</th>
                <th>Admission Year</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in page_obj %}
            <tr>
                <td>
                    {% if student.profile_pic %}
                    <img src="{{ student.profile_pic.url }}" alt="Pic" class="rounded-circle" width="40" height="40">
                    {% else %}
                    <span class="text-muted">No IMG</span>
                    {% endif %}
                </td>
                <td>{{ student.roll_number }}</td>
                <td>{{ student.user.get_full_name }}</td>
                <td>
    {% if student.enrollments.exists %}
        {% for enrollment in student.enrollments.all %}
            <span class="badge bg-primary mb-1">
                {{ enrollment.course.title }}
            </span>
        {% endfor %}
    {% else %}
        <span class="text-muted">No course</span>
    {% endif %}
</td>
                <td>{{ student.year_of_admission }}</td>
                <td>
                    <a href="{% url 'students:student_detail' student.pk %}"
                        class="btn btn-sm btn-info text-white">View</a>
                    <a href="{% url 'students:student_update' student.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'students:student_delete' student.pk %}" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No students found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1&q={{ query }}">&laquo; First</a></li>
        <li class="page-item"><a class="page-link"
                href="?page={{ page_obj.previous_page_number }}&q={{ query }}">Previous</a></li>
        {% endif %}

        <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{
                page_obj.paginator.num_pages }}</span></li>

        {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ query }}">Next</a>
        </li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&q={{ query }}">Last
                &raquo;</a></li>
        {% endif %}
    </ul>
</nav>

{% endblock %}